<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Break - Inicio</title>

  <!-- Icono de sitio -->
  <link href="assets/img/favicon.png" rel="icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Archivos externos CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet"> <!-- Animacion del inicio -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">

  <!-- Llama a hoja de estilo -->
  <link href="../css/styleinicio.css" rel="stylesheet">
</head>

<body>

  <!-- Barra de navegación -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm justify-content-end">
    <a class="navbar-brand" href="#">Break</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">Inicio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Perfil</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Configuración</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="openDriveModal()">Google Drive</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Cerrar sesión</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Contenido principal -->
  <div class="container-fluid content">
    <div class="row">
      <!-- Barra lateral izquierda -->
      <div class="col-md-3 sidebar">
        <div class="profile-section">
          <h5>Mi Perfil</h5>
          <img src="https://via.placeholder.com/80" class="rounded-circle mb-3" alt="Foto de perfil">
          <p><strong>Nombre de Usuario</strong></p>
          <p><a href="#">Ver perfil</a></p>
          <hr>
          <h6>Enlaces rápidos</h6>
          <ul class="list-unstyled">
            <li><a href="#">Amigos</a></li>
            <li><a href="#">Grupos</a></li>
            <li><a href="#">Eventos</a></li>
            <li><a href="#">Mensajes</a></li>
            <li><a href="#">Google Drive</a></li>
          </ul>
        </div>
      </div>

      <!-- Área de publicaciones -->
      <div class="col-md-6 main-content">
        <!-- Publicar nueva actualización -->
        <div class="post-section">
          <h5>¿Qué estás pensando?</h5>
          <form>
            <div class="form-group">
              <textarea class="form-control" rows="3" placeholder="Escribe algo..."></textarea>
            </div><br>
            <button type="submit" class="btn btn-primary">Publicar</button>
          </form>
        </div>

        <!-- Feed de publicaciones -->
        <div class="feed">
          <!-- Aquí van las publicaciones -->
          <div class="card mb-3">
            <div class="card-body">
              <div class="media">
                <img src="https://via.placeholder.com/40" class="mr-3 rounded-circle" alt="...">
                <div class="media-body">
                  <h5 class="card-title">Usuario1</h5>
                  <p class="card-text">Esta es una publicación de ejemplo.</p>
                  <p class="card-text"><small class="text-muted">Hace 10 minutos</small></p>
                  <!-- Sección de comentarios -->
                  <div class="comment-section">
                    <h6>Comentarios</h6>
                    <div class="media mb-3">
                      <img src="https://via.placeholder.com/40" class="mr-3 rounded-circle" alt="...">
                      <div class="media-body">
                        <h6 class="mt-0">UsuarioA</h6>
                        ¡Qué interesante publicación!
                      </div>
                    </div>
                    <!-- Formulario para agregar comentario -->
                    <form>
                      <div class="form-group">
                        <textarea class="form-control" rows="2" placeholder="Escribe un comentario..."></textarea>
                      </div><br>
                      <button type="submit" class="btn btn-secondary">Comentar</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Otra publicación -->
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Usuario2</h5>
              <p class="card-text">Otra publicación de ejemplo.</p>
              <p class="card-text"><small class="text-muted">Hace 30 minutos</small></p>
              <!-- Sección de comentarios -->
              <div class="comment-section">
                <h6>Comentarios</h6>
                <div class="media mb-3">
                  <img src="https://via.placeholder.com/40" class="mr-3 rounded-circle" alt="...">
                  <div class="media-body">
                    <h6 class="mt-0">UsuarioB</h6>
                    Muy buena información, gracias por compartir.
                  </div>
                </div>
                <!-- Formulario para agregar comentario -->
                <form>
                  <div class="form-group">
                    <textarea class="form-control" rows="2" placeholder="Escribe un comentario..."></textarea>
                  </div>
                  <br>
                  <button type="submit" class="btn btn-secondary">Comentar</button>
                </form>
              </div>
            </div>
          </div>

          <!-- Puedes añadir más publicaciones aquí -->
        </div>
      </div>

      <!-- Barra lateral derecha -->
      <div class="col-md-3 sidebar">
        <!-- Aquí van las sugerencias y tendencias -->
       
        <div class="suggestions-section">
          <h5>Sugerencias de amigos</h5>
          <div class="media mb-3">
            <img src="https://via.placeholder.com/40" class="mr-3 rounded-circle" alt="...">
            <div class="media-body">
              <h6 class="mt-0">UsuarioSugerido1</h6>
              <button class="btn btn-primary btn-sm">Agregar amigo</button>
            </div>
          </div>
          <!-- Más sugerencias -->
        </div>

        <div class="trending-section">
          <h5>Tendencias</h5>
          <ul class="list-unstyled">
            <li><a href="#">#Tendencia1</a></li>
            <li><a href="#">#Tendencia2</a></li>
            <!-- Más tendencias -->
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Google Drive -->
  <div class="modal fade" id="googleDriveModal" tabindex="-1" aria-labelledby="googleDriveModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="googleDriveModalLabel">Google Drive</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Contenido del modal generado por JavaScript -->
          <div id="fileList" class="mt-3"></div> <!-- Contenedor para la lista de archivos -->
          <button onclick="uploadFile()">Subir Archivo</button>
          <button onclick="shareFile()">Compartir Archivo</button>
          <button onclick="downloadFile()">Descargar Archivo</button>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts de Bootstrap y jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    $(document).ready(function() {
      // Animación suave en los enlaces de navegación
      $('nav a').on('click', function(event) {
        if (this.hash !== "") {
          event.preventDefault();
          var hash = this.hash;
          $('html, body').animate({
            scrollTop: $(hash).offset().top
          }, 800, function() {
            window.location.hash = hash;
          });
        }
      });

      // Desplegable animado en la barra de navegación
      $('.navbar-toggler').on('click', function() {
        $('#navbarNav').slideToggle();
      });

      // Publicar actualización sin recargar la página
      $('.post-section form').on('submit', function(event) {
        event.preventDefault();
        var postContent = $(this).find('textarea').val();
        if (postContent) {
          var newPost = `
            <div class="card mb-3">
              <div class="card-body">
                <div class="media">
                  <img src="https://via.placeholder.com/40" class="mr-3 rounded-circle" alt="...">
                  <div class="media-body">
                    <h5 class="card-title">Tu Nombre</h5>
                    <p class="card-text">` + postContent + `</p>
                    <p class="card-text"><small class="text-muted">Justo ahora</small></p>
                    <div class="comment-section">
                      <h6>Comentarios</h6>
                      <form>
                        <div class="form-group">
                          <textarea class="form-control" rows="2" placeholder="Escribe un comentario..."></textarea>
                        </div><br>
                        <button type="submit" class="btn btn-secondary">Comentar</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>`;
          $('.feed').prepend(newPost);
          $(this).find('textarea').val('');
        }
      });

      // Añadir un comentario con efecto de animación
      $(document).on('submit', '.comment-section form', function(event) {
        event.preventDefault();
        var commentContent = $(this).find('textarea').val();
        if (commentContent) {
          var newComment = `
            <div class="media mb-3">
              <img src="https://via.placeholder.com/40" class="mr-3 rounded-circle" alt="...">
              <div class="media-body">
                <h6 class="mt-0">Tu Nombre</h6>
                ` + commentContent + `
              </div>
            </div>`;
          $(this).before(newComment);
          $(this).find('textarea').val('');
          $('.media-body').first().hide().fadeIn(800);
        }
      });
    });

    // Variables globales
    let accessToken;

    // Función para abrir el modal de Google Drive
    function openDriveModal() {
      $('#googleDriveModal').modal('show');
    }

    // Función para cargar la API de Google Drive
    function gapiLoaded() {
      // API Key y Client ID de tu cuenta
      const CLIENT_ID = '84594609583-ha33co75pegiprbrapsil1u8bml4d0i9.apps.googleusercontent.com';
      const API_KEY = 'AIzaSyCG5D-HEBAmK1lR8VRazG99Ta8OuyfSmD0';

      // Discovery doc URL para las APIs usadas por el quickstart
      const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';

      // Scopes de autorización requeridos por la API
      const SCOPES = 'https://www.googleapis.com/auth/drive';

      // Inicializar cliente API
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: [DISCOVERY_DOC],
        scope: SCOPES
      }).then(function() {
        console.log('Google Drive API loaded successfully');
        // Verificar el estado de la autenticación
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
        // Manejar el estado de la autenticación inicial
        updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      }, function(error) {
        console.error('Error loading Google Drive API:', error);
      });

      // Actualizar el estado de inicio de sesión
      function updateSignInStatus(isSignedIn) {
        if (isSignedIn) {
          // Usuario autenticado
          accessToken = gapi.auth.getToken().access_token;
        } else {
          // Usuario no autenticado
          accessToken = null;
        }
      }

      // Función para subir un archivo
      function uploadFile() {
        // ID de la carpeta en Google Drive donde se va a subir el archivo
        const folderId = 'ID_DE_LA_CARPETA';

        // Crear un input de tipo archivo para seleccionar el archivo a subir
        const fileInput = document.createElement('input');
        fileInput.type = 'file';

        // Escuchar el evento de cambio del input de archivo
        fileInput.addEventListener('change', (event) => {
          const file = event.target.files[0];
          if (file) {
            // Crear un objeto FormData para enviar el archivo
            const formData = new FormData();
            formData.append('file', file);

            // Realizar una petición POST para subir el archivo
            fetch(`https://www.googleapis.com/upload/drive/v3/files?uploadType=media&parents=${folderId}`, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${accessToken}`,
              },
              body: formData,
            })
            .then(response => response.json())
            .then(data => {
              console.log('Archivo subido:', data);
              // Actualizar la lista de archivos después de la carga exitosa
              listFiles();
            })
            .catch(error => console.error('Error al subir el archivo:', error));
          }
        });

        // Simular un clic en el input de archivo para abrir el selector de archivos
        fileInput.click();
      }

      // Función para compartir un archivo
      function shareFile() {
        // ID del archivo que se va a compartir
        const fileId = 'ID_DEL_ARCHIVO';

        // Crear un objeto de configuración para la solicitud de compartir
        const body = {
          role: 'reader', // Rol del usuario compartido (lector)
          type: 'anyone', // Tipo de usuario compartido (cualquiera)
        };

        // Realizar una petición POST para compartir el archivo
        fetch(`https://www.googleapis.com/drive/v3/files/${fileId}/permissions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${accessToken}`,
          },
          body: JSON.stringify(body),
        })
        .then(response => response.json())
        .then(data => {
          console.log('Archivo compartido:', data);
        })
        .catch(error => console.error('Error al compartir el archivo:', error));
      }

      // Función para descargar un archivo
      function downloadFile() {
        // ID del archivo que se va a descargar
        const fileId = 'ID_DEL_ARCHIVO';

        // Crear un elemento <a> para descargar el archivo
        const downloadLink = document.createElement('a');

        // Configurar el enlace de descarga
        downloadLink.href = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;
        downloadLink.target = '_blank'; // Abrir en una nueva pestaña
        downloadLink.setAttribute('download', 'nombre_del_archivo'); // Nombre del archivo a descargar

        // Simular un clic en el enlace para iniciar la descarga
        downloadLink.click();
      }

      // Función para obtener la lista de archivos del usuario y mostrarlos en el modal
      async function listFiles() {
        let response;
        try {
          response = await gapi.client.drive.files.list({
            'pageSize': 10,
            'fields': 'files(id, name)',
          });
        } catch (err) {
          document.getElementById('fileList').innerText = err.message;
          return;
        }
        const files = response.result.files;
        if (!files || files.length === 0) {
          document.getElementById('fileList').innerHTML = '<p>No se encontraron archivos.</p>';
          return;
        }
        // Construir la tabla de archivos
        let fileListHTML = '<h3>Archivos:</h3><table class="table"><thead><tr><th>ID</th><th>Nombre</th></tr></thead><tbody>';
        files.forEach((file) => {
          fileListHTML += `<tr><td>${file.id}</td><td>${file.name}</td></tr>`;
        });
        fileListHTML += '</tbody></table>';
        document.getElementById('fileList').innerHTML = fileListHTML;
      }
    </script>
  </body>
</html>